version: '2.1'

executors:
  go:
    docker:
      - image: circleci/golang:1.15
  docker:
    docker:
      - image: docker:19-git

jobs:
  test:
    executor: go
    steps:
      - checkout
      - run:
          name: Run tests
          command: gotestsum --junitfile unit-tests.xml
      - store_test_results:
          path: unit-tests.xml
      - store_artifacts:
          path: unit-tests.xml

  build_docker:
    executor: docker
    steps:
      - checkout
      - setup_remote_docker:
          docker_layer_caching: true
      - run:
          name: Build
          command: |
            docker build . -t timoreymann/webp-utils:latest


workflows:
  build:
    jobs:
      - test
      - build_docker
